# annotations
annot <- list(x = 0, y=0.8, text = "Projection", yanchor = 'bottom',
xref = 'paper', xanchor = 'right',
showarrow = FALSE)
# original d3-globe with contours
fig<- plot_geo(d)
fig <- fig %>% group_by(line)
fig <- fig %>% add_lines(x = ~lon, y = ~lat, color = ~line, colors = 'Reds')
fig <- fig %>% layout(
showlegend = FALSE, geo = geo
)
# plot with custom events
fig<- fig
fig <- fig %>% layout(annotations = annot,
updatemenus = list(list(active = 2, x = 0, y = 0.8,
buttons=all_buttons)),
sliders = list(
list(
active = (length(lon_range[,])-1)/2,
currentvalue = list(prefix = "Longitude: "),
pad = list(t = 20),
steps = all_lon),
list(
active = (length(lat_range[,])-1)/2,
currentvalue = list(prefix = "Latitude: "),
pad = list(t = 100),
steps = all_lat)))
fig
library(plotly)
fig <- plot_ly()
# fig <- fig %>% add_trace( ... )
# fig <- fig %>% layout( ... )
library(dash)
library(dashCoreComponents)
library(dashHtmlComponents)
app <- Dash$new()
app$layout(
htmlDiv(
list(
dccGraph(figure=fig)
)
)
)
app$run_server(debug=TRUE, dev_tools_hot_reload=FALSE)
install.packages("dash")
install.packages("dashCoreComponents")
install.packages("dashHtmlComponents")
library(plotly)
fig <- plot_ly()
# fig <- fig %>% add_trace( ... )
# fig <- fig %>% layout( ... )
library(dash)
library(dashCoreComponents)
library(dashHtmlComponents)
app <- Dash$new()
app$layout(
htmlDiv(
list(
dccGraph(figure=fig)
)
)
)
app$run_server(debug=TRUE, dev_tools_hot_reload=FALSE)
fig
"scatter"
end
>end
fig
>end
stop(dash_app())
library(plotly)
library(MASS)
covmat <- matrix(c(0.8, 0.4, 0.3, 0.8), nrow = 2, byrow = T)
df <- mvrnorm(n = 10000, c(0,0), Sigma = covmat)
df <- as.data.frame(df)
colnames(df) <- c("x", "y")
fig <- plot_ly(df, x = ~x, y = ~y, alpha = 0.3)
fig <- fig %>% add_markers(marker = list(line = list(color = "black", width = 1)))
fig <- fig %>% layout(
title = "Drop down menus - Plot type",
xaxis = list(domain = c(0.1, 1)),
yaxis = list(title = "y"),
updatemenus = list(
list(
y = 0.8,
buttons = list(
list(method = "restyle",
args = list("type", "scatter"),
label = "Scatter"),
list(method = "restyle",
args = list("type", "histogram2d"),
label = "2D Histogram")))
))
fig
x=0:1,size=200
x=(0:1,size=200)
x=0:1:100
x=seq(0,1,100)
x
x=seq(0,1,length(100))
x
x=seq(0,1,length.out(100))
x=seq(0,1,length.out=100)
x
y=1-x
y
library(plotly)
p=plot_ly(x,y,type = "scatter")
p=plot_ly(data= data.entry(x,y), x,y,type = "scatter")
p=plot_ly(data= data.frame(x,y), x,y,type = "scatter")
p
p=plot_ly(data= data.frame(x,y), x,y,type = 'scatter')
p
p=plot_ly(data= data.frame(x,y), x,y,type = 'set')
p
p=plot_ly(data= data.frame(x,y), x,y,mode='linr')
p=plot_ly(data= data.frame(x,y), x,y,mode='line')
p
plot(x,y)
?plot_ly
data=data.frame(x,y)
data
plot_ly(data,x,y,type = 'line')
plot_ly(data,x,y,type = 'scatter')
plot_ly(data,x=x,y=y,type = 'scatter')
plot_ly(data,x=x,y=y,type = 'scatter',mode='lines')
p=plot_ly(data,x=x,y=y,type = 'scatter',mode='lines')
p=p%>%add_trace(data,x=x,y=y,type = 'scatter')
p
p=p%>%add_trace(data,x=x,y=y,type = 'scatter',mode='markers')
p
library(png)
source("~/.active-rstudio-document")
display<-function(...){
imageList<-list(...)
totalWidth<-0
maxHeight<-0
for (img in imageList){
if(is.character(img))
img<-readPNG(img)
dimg<-dim(img)
totalWidth<-totalWidth+dimg[2]
maxHeight<-max(maxHeight,dimg[1])
}
par(mar=c(0,0,0,0))
plot(c(0,totalWidth),c(0,maxHeight),type="n",asp=1,xaxt="n",yaxt="n",xlab="x",ylab="y")
offset<-0
for (img in imageList){
dimg<-dim(img)
rasterImage(img,offset,0,offset+dimg[2],dimg[1])
offset<-offset+dimg[2]
}
}
img
def get_indicators(ticker):
url = "https://www.casablanca-bourse.com/bourseweb/Societe-Cote.aspx?codeValeur="+str(cblu.ticker_2_CodeValeur(ticker))+"&cat=7"
req = requests.get(url)
soup = BeautifulSoup(req.text, "html.parser")
view_state = soup.find("input", {"id": "__VIEWSTATE"})['value']
view_state_generator = soup.find("input", {"id": "__VIEWSTATEGENERATOR"})['value']
payload = {
'TopControl1$ScriptManager1': 'SocieteCotee1$UpdatePanel1|SocieteCotee1$LBFicheTech',
'__EVENTTARGET': 'SocieteCotee1$LBFicheTech',
'__EVENTARGUMENT': '',
'__LASTFOCUS': '',
'__VIEWSTATE': view_state,
'__VIEWSTATEGENERATOR': view_state_generator,
}
get_indicators=function(ticker){
url = "https://www.casablanca-bourse.com/bourseweb/Societe-Cote.aspx?codeValeur="+str(cblu.ticker_2_CodeValeur(ticker))+"&cat=7"
req = requests.get(url)
soup = BeautifulSoup(req.text, "html.parser")
view_state = soup.find("input", {"id": "__VIEWSTATE"})['value']
view_state_generator = soup.find("input", {"id": "__VIEWSTATEGENERATOR"})['value']
payload = {
'TopControl1$ScriptManager1': 'SocieteCotee1$UpdatePanel1|SocieteCotee1$LBFicheTech',
'__EVENTTARGET': 'SocieteCotee1$LBFicheTech',
'__EVENTARGUMENT': '',
'__LASTFOCUS': '',
'__VIEWSTATE': view_state,
'__VIEWSTATEGENERATOR': view_state_generator,
}
get_indicators=function(ticker){
url = "https://www.casablanca-bourse.com/bourseweb/Societe-Cote.aspx?codeValeur="+str(cblu.ticker_2_CodeValeur(ticker))+"&cat=7"
req = requests.get(url)
soup = BeautifulSoup(req.text, "html.parser")
view_state = soup.find("input", {"id": "__VIEWSTATE"})['value']
view_state_generator = soup.find("input", {"id": "__VIEWSTATEGENERATOR"})['value']
payload = {
'TopControl1$ScriptManager1': 'SocieteCotee1$UpdatePanel1|SocieteCotee1$LBFicheTech',
'__EVENTTARGET': 'SocieteCotee1$LBFicheTech',
'__EVENTARGUMENT': '',
'__LASTFOCUS': '',
'__VIEWSTATE': view_state,
'__VIEWSTATEGENERATOR': view_state_generator,
}}
install.packages("rvest")
reticulate::repl_python()
}
yes
library(rvest)
library(dplyr)
link='https://www.casablanca-bourse.com/bourseweb/Activite-marche.aspx?Cat=22&IdLink=297'
page=read_html(link)
page=page %>% html_nodes('table')
View(page)
page=page %>% html_nodes('td')
warning()
warning(page)
page=page %>% html_nodes('td arial11bleu"')
page=page %>% html_nodes('td arial11bleu')
page=page %>% html_nodes('td.arial11bleu')
page=page %>% html_nodes('table')
library(rvest)
library(dplyr)
link='https://www.casablanca-bourse.com/bourseweb/Activite-marche.aspx?Cat=22&IdLink=297'
page=read_html(link)
page=page %>% html_nodes('table')
View(projections)
page=page %>% html_nodes('table.arial11bleu')
View(page)
page[[1]]
xml_child(page[[1]], 1)
xml_attrs(page[[1]])
page=page %>% html_nodes('table') %>% html_text()
library(rvest)
library(dplyr)
link='https://www.casablanca-bourse.com/bourseweb/Activite-marche.aspx?Cat=22&IdLink=297'
page=read_html(link)
page=page %>% html_nodes('table') %>% html_text()
page=page %>% html_nodes('td.arial11turquoibold') %>% html_table()
page=page %>% html_nodes('td.arial11turquoibold') %>% data_frame()
View(page)
page
library(rvest)
library(dplyr)
link='https://www.casablanca-bourse.com/bourseweb/Activite-marche.aspx?Cat=22&IdLink=297'
page=read_html(link)
page=page %>% html_nodes('tbody') %>% html_text()
page=page %>% html_nodes('td.arial11turquoibold') %>% data_frame()
page=page %>% html_nodes('td.arial11turquoibold') %>%html_table()
page=page %>% html_nodes('td.arial11noir') %>% data_frame()
library(rvest)
library(dplyr)
link='https://www.casablanca-bourse.com/bourseweb/Activite-marche.aspx?Cat=22&IdLink=297'
page=read_html(link)
page=page %>% html_nodes('table') %>% html_text()
page=page %>% html_nodes('td.arial11noir') %>% data_frame()
page=page %>% html_nodes('td.arial11noir') %>% html_text()
page=page %>% html_nodes('td.arial11noir') %>% data_frame())
page=page %>% html_nodes('td.arial11noir') %>% data_frame()
library(rvest)
library(dplyr)
link='https://www.casablanca-bourse.com/bourseweb/Activite-marche.aspx?Cat=22&IdLink=297'
page=read_html(link)
page=page %>% html_nodes('.arial11noir , #ActiviteMarche1_IndiceSectoriel1_RPTLIndSect_ctl01_Label1') %>% html_text()
page=page %>% data_frame()
View(page)
library(rvest)
library(dplyr)
link='https://www.casablanca-bourse.com/bourseweb/Activite-marche.aspx?Cat=22&IdLink=297'
page=read_html(link)
page=page %>% html_nodes('.arial11noir , #ActiviteMarche1_IndiceSectoriel1_RPTLIndSect_ctl01_Label1') %>% html_table()
View(page)
View(page[[1]])
page=page %>% html_nodes('.arial11noir , #ActiviteMarche1_IndiceSectoriel1_RPTLIndSect_ctl01_Label1') %>%
data_frame()
library(rvest)
library(dplyr)
link='https://www.casablanca-bourse.com/bourseweb/Activite-marche.aspx?Cat=22&IdLink=297'
page=read_html(link)
page=page %>% html_nodes('.arial11noir , #ActiviteMarche1_IndiceSectoriel1_RPTLIndSect_ctl01_Label1') %>%
data_frame()
View(page)
library(rvest)
library(dplyr)
link='https://www.casablanca-bourse.com/bourseweb/Activite-marche.aspx?Cat=22&IdLink=297'
page=read_html(link)
page=page %>% html_nodes('td td td td td td td') %>%
data_frame()
library(rvest)
library(dplyr)
link='https://www.casablanca-bourse.com/bourseweb/Activite-marche.aspx?Cat=22&IdLink=297'
page=read_html(link)
page=page %>% html_nodes('td td td td td td td')
page=page %>% data_frame()
page=page %>% html_table()
View(page)
library(rvest)
library(dplyr)
link='https://www.casablanca-bourse.com/bourseweb/Activite-marche.aspx?Cat=22&IdLink=297'
page=read_html(link)
page=page %>% html_nodes('#arial11bleu')
page=page %>% html_table()
View(page)
library(rvest)
library(dplyr)
link='https://www.casablanca-bourse.com/bourseweb/Activite-marche.aspx?Cat=22&IdLink=297'
page=read_html(link)
page=page %>% html_nodes('#arial11bleu')
page=page %>% data_frame()
page=page %>% tibble(data_frame())
page=page %>% tibble(data_frame)
?tibble
page=page %>% tibble()
page=page %>% data_frame_()
library(rvest)
library(dplyr)
link='https://www.casablanca-bourse.com/bourseweb/Activite-marche.aspx?Cat=22&IdLink=297'
page=read_html(link)
page=page %>% html_nodes('#arial11bleu')
page=page %>% data_frame_()
library(rvest)
library(dplyr)
link='https://www.casablanca-bourse.com/bourseweb/Activite-marche.aspx?Cat=22&IdLink=297'
page=read_html(link)
page=page %>% html_nodes('#arial11bleu')
page=page %>% tibble()
library(rvest)
library(dplyr)
link='https://docs.google.com/spreadsheets/d/1gYSo8SnPLs2xN96j1KPa5_ESIay_Tew779kJ7vBHiYY/edit#gid=0'
page=read_html(link)
page=page %>% data_frame()
View(page)
t=read.table("https://docs.google.com/spreadsheets/d/1gYSo8SnPLs2xN96j1KPa5_ESIay_Tew779kJ7vBHiYY/edit#gid=0")
t
t=attach("https://docs.google.com/spreadsheets/d/1gYSo8SnPLs2xN96j1KPa5_ESIay_Tew779kJ7vBHiYY/edit#gid=0")
t=read.csv("https://docs.google.com/spreadsheets/d/1gYSo8SnPLs2xN96j1KPa5_ESIay_Tew779kJ7vBHiYY/edit#gid=0")
t
View(t)
readGoogleSheet <- function(url, na.string="", header=TRUE){
stopifnot(require(XML))
# Suppress warnings because Google docs seems to have incomplete final line
suppressWarnings({
doc <- paste(readLines(url), collapse=" ")
})
if(nchar(doc) == 0) stop("No content found")
htmlTable <- gsub("^.*?(<table.*</table).*$", "\\1>", doc)
ret <- readHTMLTable(htmlTable, header=header, stringsAsFactors=FALSE, as.data.frame=TRUE)
lapply(ret, function(x){ x[ x == na.string] <- NA; x})
}
cleanGoogleTable <- function(dat, table=1, skip=0, ncols=NA, nrows=-1, header=TRUE, dropFirstCol=NA){
if(!is.data.frame(dat)){
dat <- dat[[table]]
}
if(is.na(dropFirstCol)) {
firstCol <- na.omit(dat[[1]])
if(all(firstCol == ".") || all(firstCol== as.character(seq_along(firstCol)))) {
dat <- dat[, -1]
}
} else if(dropFirstCol) {
dat <- dat[, -1]
}
if(skip > 0){
dat <- dat[-seq_len(skip), ]
}
if(nrow(dat) == 1) return(dat)
if(nrow(dat) >= 2){
if(all(is.na(dat[2, ]))) dat <- dat[-2, ]
}
if(header && nrow(dat) > 1){
header <- as.character(dat[1, ])
names(dat) <- header
dat <- dat[-1, ]
}
# Keep only desired columns
if(!is.na(ncols)){
ncols <- min(ncols, ncol(dat))
dat <- dat[, seq_len(ncols)]
}
# Keep only desired rows
if(nrows > 0){
nrows <- min(nrows, nrow(dat))
dat <- dat[seq_len(nrows), ]
}
# Rename rows
rownames(dat) <- seq_len(nrow(dat))
dat
}
readGoogleSheet("https://docs.google.com/spreadsheets/d/1gYSo8SnPLs2xN96j1KPa5_ESIay_Tew779kJ7vBHiYY/edit?usp=sharing")
install.packages("gsheet")
library(gsheet)
t=gsheet2tbl('https://docs.google.com/spreadsheets/d/1gYSo8SnPLs2xN96j1KPa5_ESIay_Tew779kJ7vBHiYY/edit?usp=sharing')
View(t)
detach("package:gsheet", unload = TRUE)
gsheet2tbl <- function(url, sheetid = NULL){
if(requireNamespace('readr', quietly=TRUE)){
suppressMessages(table <- readr::read_csv(file = construct_download_url(url, format='csv', sheetid = NULL)))
}else{
table <- utils::read.csv(text=gsheet2text(url=url, format='csv', sheetid=sheetid), stringsAsFactors=FALSE)
class(table) <- c("tbl_df", "tbl", "data.frame")
}
return(table)
}
d=gsheet2tbl('https://docs.google.com/spreadsheets/d/1gYSo8SnPLs2xN96j1KPa5_ESIay_Tew779kJ7vBHiYY/edit?usp=sharing')
construct_download_url <- function(url, format='csv', sheetid = NULL){
key <- stringr::str_extract(url, '[[:alnum:]_-]{30,}')
if(is.null(sheetid) & stringr::str_detect(url, 'gid=[[:digit:]]+')){
sheetid <- as.numeric(stringr::str_extract(stringr::str_extract(url,'gid=[[:digit:]]+'),'[[:digit:]]+'))
}
address <- paste0('https://docs.google.com/spreadsheets/export?id=',key,'&format=',format)
if(!is.null(sheetid)){
address <- paste0(address, '&gid=', sheetid)
}
return(address)
}
gsheet2tbl <- function(url, sheetid = NULL){
if(requireNamespace('readr', quietly=TRUE)){
suppressMessages(table <- readr::read_csv(file = construct_download_url(url, format='csv', sheetid = NULL)))
}else{
table <- utils::read.csv(text=gsheet2text(url=url, format='csv', sheetid=sheetid), stringsAsFactors=FALSE)
class(table) <- c("tbl_df", "tbl", "data.frame")
}
return(table)
}
d=gsheet2tbl('https://docs.google.com/spreadsheets/d/1gYSo8SnPLs2xN96j1KPa5_ESIay_Tew779kJ7vBHiYY/edit?usp=sharing')
d
View(d)
library(plotly)
plot_ly(data = d,y=d$Valeur)
d$index
row(d)
h=gsheet2tbl(https://docs.google.com/spreadsheets/d/1rmOSLDFwVYtqlnnhzSOdIngGVgznkiPsguGW3ewzNN0/edit#gid=0)
h=gsheet2tbl("https://docs.google.com/spreadsheets/d/1rmOSLDFwVYtqlnnhzSOdIngGVgznkiPsguGW3ewzNN0/edit#gid=0")
View(h)
h=gsheet2tbl("https://docs.google.com/spreadsheets/d/1rmOSLDFwVYtqlnnhzSOdIngGVgznkiPsguGW3ewzNN0/edit?usp=sharing")
h %>% filter(!is.na((h)))
View(h)
h[,2:4]
source("~/.active-rstudio-document")
masi.data=function(){
return(gsheet2tbl("https://docs.google.com/spreadsheets/d/1OepCwQ1w4htUL5YvIiCMUAR3KCICdACKouy2uppii0Y/edit?usp=sharing"))
}
k=masi.data()
View(k)
gsheet2tbl <- function(url, sheetid = NULL){
if(requireNamespace('readr', quietly=TRUE)){
suppressMessages(table <- readr::read_csv(file = construct_download_url(url, format='csv', sheetid = NULL)))
}else{
table <- utils::read.csv(text=gsheet2text(url=url, format='csv', sheetid=sheetid), stringsAsFactors=FALSE)
class(table) <- c("tbl_df", "tbl", "data.frame")
}
return(table)
}
gsheet2text <- function(url, format='csv', sheetid = NULL){
address <- construct_download_url(url=url, format=format, sheetid = sheetid)
page <- httr::GET(address)
if(stringr::str_detect(page$headers$`content-type`, stringr::fixed('text/html'))){
stop("Unable to retrieve document. Is 'share by link' enabled for this sheet?")
}
content <- httr::content(page, as='text')
return(content)
}
masi.data=function(){
return(gsheet2tbl("https://docs.google.com/spreadsheets/d/1OepCwQ1w4htUL5YvIiCMUAR3KCICdACKouy2uppii0Y/edit?usp=sharing"))
}
get.tickers=function(){
return(gsheet2text("https://docs.google.com/spreadsheets/d/1o8IgWa040xazF3QFoFidMcR1xqOT36CtKswQRZeEmws/edit?usp=sharing"))
}
masi=masi.data()
masi.data=function(){
return(gsheet2tbl("https://docs.google.com/spreadsheets/d/1OepCwQ1w4htUL5YvIiCMUAR3KCICdACKouy2uppii0Y/edit?usp=sharing"))
}
ticker=get.tickers()
construct_download_url <- function(url, format='csv', sheetid = NULL){
key <- stringr::str_extract(url, '[[:alnum:]_-]{30,}')
if(is.null(sheetid) & stringr::str_detect(url, 'gid=[[:digit:]]+')){
sheetid <- as.numeric(stringr::str_extract(stringr::str_extract(url,'gid=[[:digit:]]+'),'[[:digit:]]+'))
}
address <- paste0('https://docs.google.com/spreadsheets/export?id=',key,'&format=',format)
if(!is.null(sheetid)){
address <- paste0(address, '&gid=', sheetid)
}
return(address)
}
gsheet2tbl <- function(url, sheetid = NULL){
if(requireNamespace('readr', quietly=TRUE)){
suppressMessages(table <- readr::read_csv(file = construct_download_url(url, format='csv', sheetid = NULL)))
}else{
table <- utils::read.csv(text=gsheet2text(url=url, format='csv', sheetid=sheetid), stringsAsFactors=FALSE)
class(table) <- c("tbl_df", "tbl", "data.frame")
}
return(table)
}
gsheet2text <- function(url, format='csv', sheetid = NULL){
address <- construct_download_url(url=url, format=format, sheetid = sheetid)
page <- httr::GET(address)
if(stringr::str_detect(page$headers$`content-type`, stringr::fixed('text/html'))){
stop("Unable to retrieve document. Is 'share by link' enabled for this sheet?")
}
content <- httr::content(page, as='text')
return(content)
}
masi.data=function(){
return(gsheet2tbl("https://docs.google.com/spreadsheets/d/1OepCwQ1w4htUL5YvIiCMUAR3KCICdACKouy2uppii0Y/edit?usp=sharing"))
}
get.tickers=function(){
return(gsheet2text("https://docs.google.com/spreadsheets/d/1o8IgWa040xazF3QFoFidMcR1xqOT36CtKswQRZeEmws/edit?usp=sharing"))
}
masi=masi.data()
ticker=get.tickers()
return(gsheet2text("https://docs.google.com/spreadsheets/d/1o8IgWa040xazF3QFoFidMcR1xqOT36CtKswQRZeEmws/edit?usp=sharing"))
return(gsheet2tbl("https://docs.google.com/spreadsheets/d/1o8IgWa040xazF3QFoFidMcR1xqOT36CtKswQRZeEmws/edit?usp=sharing"))
return(gsheet2tbl("https://docs.google.com/spreadsheets/d/1o8IgWa040xazF3QFoFidMcR1xqOT36CtKswQRZeEmws/edit?usp=sharing"))
masi.data=function(){
return(gsheet2tbl("https://docs.google.com/spreadsheets/d/1OepCwQ1w4htUL5YvIiCMUAR3KCICdACKouy2uppii0Y/edit?usp=sharing"))
}
get.tickers=function(){
return(gsheet2tbl("https://docs.google.com/spreadsheets/d/1o8IgWa040xazF3QFoFidMcR1xqOT36CtKswQRZeEmws/edit?usp=sharing"))
}
ticker=get.tickers()
setwd("~/casabourse")
